<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTP Clock Firmware Installer</title>
    <script type="module" src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 0.9em;
        }
        
        input[type="text"],
        input[type="password"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="password"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .info-box {
            background: #f5f5f5;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            font-size: 0.9em;
            color: #666;
        }
        
        .info-box strong {
            color: #333;
        }
        
        .install-button-container {
            margin-top: 30px;
            text-align: center;
        }
        
        .browser-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        
        .browser-warning strong {
            display: block;
            margin-bottom: 5px;
        }
        
        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.9em;
            display: none;
        }
        
        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>NTP Clock Firmware Installer</h1>
        <p class="subtitle">Install firmware and configure your ESP32-S3 NTP Clock</p>
        
        <div class="browser-warning">
            <strong>⚠️ Browser Compatibility</strong>
            This installer requires Chrome, Edge, or another Chromium-based browser with Web Serial API support.
        </div>
        
        <div class="info-box" style="background: #fff3cd; border-left-color: #ffc107;">
            <strong>✨ Improv WiFi Support</strong><br>
            This firmware includes Improv WiFi support. After installation completes, ESP Web Tools will automatically detect this and show a WiFi provisioning interface. You'll be able to enter your WiFi credentials directly in that interface.
        </div>
        
        <div class="info-box">
            <strong>Installation Steps:</strong><br>
            1. Connect your ESP32-S3 board via USB<br>
            2. Click the install button below<br>
            3. Select your ESP32 device when prompted<br>
            4. After installation, ESP Web Tools will automatically detect Improv WiFi support<br>
            5. A WiFi provisioning UI will appear - enter your WiFi credentials there<br>
            6. After WiFi connects, configure timezone via the device's web interface at its IP address
        </div>
        
        <div class="info-box" style="margin-top: 15px; background: #e7f3ff; border-left-color: #2196F3;">
            <strong>ℹ️ About Timezone Configuration:</strong><br>
            Improv WiFi handles WiFi credentials automatically. After your device connects to WiFi, you can configure the timezone by visiting the device's IP address in your browser. The device will display its IP address on the screen after connecting.
        </div>
        
        <div class="install-button-container">
            <esp-web-install-button 
                id="install-button"
                manifest="manifest.json">
            </esp-web-install-button>
        </div>
        
        <div id="status-message" class="status-message"></div>
    </div>
    
    <script>
        const installButton = document.getElementById('install-button');
        const statusMessage = document.getElementById('status-message');
        
        function showStatus(message, isError = false) {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message ' + (isError ? 'error' : 'success');
            statusMessage.style.display = 'block';
        }
        
        // ESP Web Tools will automatically detect Improv WiFi support and show provisioning UI
        installButton.addEventListener('esp-web-install-button-install-success', async () => {
            showStatus('Installation complete! ESP Web Tools will now show the Improv WiFi provisioning interface.', false);
        });
        
        // Handle manifest loading errors
        installButton.addEventListener('esp-web-install-button-manifest-error', (e) => {
            console.error('Manifest error:', e.detail);
            showStatus('Failed to load firmware manifest. Please check GitHub Pages and releases.', true);
        });
    </script>
</body>
</html>
